---
date: 2025-11-17 22:14:22
---

# 组件传值

## 父向子传值

### defineProps

::: code-group

``` vue [Parent.vue]
<template>
  <child :name="name"></child>
</template>

<script setup lang="ts">
  import { ref } from "vue";
  import Child from "@/components/Child.vue";

  const name = ref("sunny");
</script>
```

``` vue [Child.vue]
<template>
  <!-- 模板中不需要 props.name，会自动解构 -->
  <p>{{ name }}</p>
</template>

<script setup lang='ts'>
  interface props {
    name: string
  }

  const { name } = defineProps<props>();
</script>
```

:::

### defineExpose

> [!NOTE]
> 
> 

::: code-group

``` vue [Parent.vue]
<template>
  <button @click="updateName">更新子组件 name 值</button>

  <child ref="childRef"></child>
</template>

<script setup lang="ts">
import { useTemplateRef } from "vue";
import Child from "@/components/Child.vue";

const childRef = useTemplateRef("childRef");

function updateName() {
  childRef.value?.setName("王一博");
}
</script>
```

``` vue [Child.vue]
<template>
  <p>{{ name }}</p>
</template>

<script setup lang='ts'>
import { ref } from "vue";

const name = ref("");

function setName(val: string) {
  name.value = val;
}

defineExpose({ setName });
</script>
```

:::


## 子向父传值

### emit
::: code-group

``` vue [Parent.vue]
<template>
  <p>{{ childName }}</p>

  <child @update:name="handleUpdateName"></child>
</template>

<script setup lang="ts">
import { ref } from "vue";
import Child from "@/components/Child.vue";

const childName = ref<string>("");

function handleUpdateName(value: string) {
  childName.value = value;
}
</script>
```

``` vue [Child.vue]
<template>
  <p>{{ name }}</p>

  <button @click="updateName">子组件更新 name 值</button>
</template>

<script setup lang='ts'>
import { ref } from "vue";

interface Emits {
  (e: "update:name", value: string): void;
}

const emit = defineEmits<Emits>();

const name = ref("tom");

function updateName() {
  name.value += "~";
  emit("update:name", name.value);
}
</script>

```

:::

### defineExpose

::: code-group

``` vue [Parent.vue]
<template>
  <child ref="childRef"></child>

  <button @click="updateName">更新子组件 name 值</button>
</template>

<script setup lang="ts">
import { useTemplateRef } from "vue";
import Child from "@/components/Child.vue";

const childRef = useTemplateRef("childRef");

function updateName() {
  // 错误做法：[Vue warn] Set operation on key "value" failed: target is readonly.
  childRef.value.name = "Alice";

  // 正确做法
  childRef.value?.updateName("Alice");
}
</script>
```

``` vue [Child.vue] {}
<template>
  <p>{{ name }}</p>
</template>

<script setup lang='ts'>
import { readonly, ref } from "vue";

const name = ref("tom");

function updateName(value: string) {
  name.value = value;
}

defineExpose({
  // 方式一：向外暴漏子组件属性，使用 readonly（vue3.3+）进行包装，避免外部更改其属性值
  name: readonly(name),
  // 方式二：使用 computed 返回只读的属性
  name: computed(() => name.value),
  // 方式三：使用 getter 函数，只允许get，不允许设置set
  get name() {
    return name.value;
  },
  updateName,
});
</script>
```
:::


## 多层组件传值

### provide + inject

::: code-group
``` vue [App.vue]
<template>
  <router-view/>
</template>

<script setup lang="ts">
import { RouterView } from "vue-router";
import { provide, reactive } from "vue";
import { USER_INFO_KEY } from "@/types/injection-keys.ts";

const userInfo = reactive({
  name: "",
  age: 25,
});

// App组件注入属性
provide(USER_INFO_KEY, userInfo);
</script>
```
``` vue [Child.vue]
<template>
  <p>{{ userInfo.name }}</p>
  <p>{{ userInfo.age }}</p>
</template>

<script setup lang='ts'>
import { inject } from "vue";
import { USER_INFO_KEY } from "@/types/injection-keys.ts";

// 注意：第二个参数表示 defaultValue，它只在未提供 provide 时才生效！
const userInfo = inject(USER_INFO_KEY, {
  name: "tom",
  age: 1,
});
</script>
```
``` typescript [injection-keys.ts]
import type { InjectionKey } from "vue";

export interface UserInfo {
  name?: string;
  age?: number;
}

export const USER_INFO_KEY: InjectionKey<UserInfo> = Symbol("USER_INFO");
```
:::

### eventBus

> [!TIP] 提示
> 推荐使用 [mitt](https://github.com/developit/mitt) 第三方库，功能更全面。
>
> ``` pnpm
> pnpm install mitt --save
> ```

::: code-group
``` typescript [eventBus.ts]
type callback = (...args: any[]) => void;

class EventBus {
  private events = new Map<string, Set<callback>>();

  emit(event: string, ...args: any[]) {
    this.events.get(event)?.forEach((cb) => cb(...args));
  }

  on(event: string, cb: callback) {
    if (!this.events.has(event)) {
      this.events.set(event, new Set());
    }
    this.events.get(event)!.add(cb);
  }

  off(event: string) {
    this.events.delete(event);
  }

  once(event: string, cb: callback) {
    const wrapper = (...args: any[]) => {
      cb(...args);
      this.off(event);
    };
    this.on(event, wrapper);
  }
}

export const emitter = new EventBus();
```

``` vue [App.vue]
<template>
  <router-view/>

  <button @click="sendMsg">发送消息</button>
</template>

<script setup lang="ts">
import { RouterView } from "vue-router";
import { emitter } from "@/utils/eventBus.ts";

function sendMsg() {
  // 传递单个字符串
  emitter.emit("SEND_MESSAGE", "hello,world");
  // 传递数组
  emitter.emit("SEND_MESSAGE1", [1, 2, 3]);
  // 传递对象
  emitter.emit("SEND_MESSAGE2", { name: "sunny" });
  // 只发布一次
  emitter.emit("SEND_MESSAGE3", { age: 25 });
}
</script>
```

``` vue [Child.vue]
<template></template>

<script setup lang='ts'>
import { onMounted } from "vue";
import { emitter } from "@/utils/eventBus.ts";

onMounted(() => {
  emitter.on("SEND_MESSAGE", (msg) => {
    console.log(msg);
  });

  emitter.on("SEND_MESSAGE1", (msg) => {
    console.log(msg);
  });

  emitter.on("SEND_MESSAGE2", (msg) => {
    console.log(msg);
  });

  // 只订阅一次
  emitter.once("SEND_MESSAGE3", (msg) => {
    console.log(msg);
  });

  setTimeout(() => {
    // 取消订阅
    emitter.off("SEND_MESSAGE2");
  }, 5000);
});
</script>
```
:::
